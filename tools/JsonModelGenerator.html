<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>JsonModel Generator</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
     <div class="container">
         <header>
             <h1>JsonModel Generator</h1>
         </header>
        <div class="step1">
            <form class="form" action="" method="post">
                <div class="form-group">
                  <label for="">Options JSON</label>
                  <textarea id="optionsJson" class="form-control" name="name" rows="8" cols="40"></textarea>
                  <p class="help-block">Copy and paste here the options: {} json object</p>
                </div>
                <div class="form-group text-center">
                  <button type="button" class="btn btn-lg btn-default" id="btnStep1" name="btnStep1">Go</button>
                </div>
            </form>
        </div>
        <div class="step2" style="display:none">
            <span class="label label-default">boolean</span>
            <span class="label label-primary">object</span>
            <span class="label label-success">string</span>
            <span class="label label-info">array</span>
            <span class="label label-warning">number</span>
            <div class="container">

            </div>
            <div class="form-group text-center">
                <button type="button" class="btn btn-lg btn-info" id="btnStep2" name="btnStep2">Generate JsonModel</button>
            </div>
        </div>
        <div class="step3" style="display:none">
            <textarea id="result" class="form-control" name="name" rows="8" cols="40"></textarea>
        </div>
     </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

    <script>
        $(function() {
            function getOptions(type) {
                var $options = $("<div>").addClass("options");
                switch(type) {
                    case "boolean":
                    case "number":
                        $("<label>").addClass("checkbox-inline")
                        .append(
                            $('<input type="checkbox" class="mandatory" value="">')
                        )
                        .append("Mandatory")
                        .appendTo($options);
                        break;
                    case "array":
                    case "string":
                    case "object":
                        $("<label>").addClass("checkbox-inline")
                        .append(
                            $('<input type="checkbox" class="mandatory" value="">')
                        )
                        .append("Mandatory")
                        .appendTo($options);
                        $("<label>").addClass("checkbox-inline")
                        .append(
                            $('<input type="checkbox" class="nonEmpty" value="">')
                        )
                        .append("Non Empty")
                        .appendTo($options);
                    default:
                        break;
                }
                return $options;
            }

            function buildTree(json, container, parentRoute) {
                for (var x in json) {
                    var route = parentRoute == "" ? x : parentRoute + "/" + x;
                    if ($.isPlainObject(json[x])) {
                        var tmpLi = $("<li>")
                        .addClass("list-group-item")
                        .attr("route", route)
                        .attr("kind", "object");

                        tmpLi.append(
                            $("<span>").addClass("label label-primary").text(x)
                        )
                        .append(
                            getOptions("object")
                        );
                        container.append(tmpLi);

                        var newContainer = $("<ul>")
                        .addClass("list-group")
                        .appendTo(tmpLi);

                        buildTree(json[x], newContainer, route);
                    } else {
                        var type = $.isArray(json[x]) ? "array" : typeof json[x];
                        var label = "label-default";
                        switch (type) {
                            case "string":
                                label = "label-success";
                                break;
                            case "array":
                                label = "label-info";
                                break;
                            case "number":
                                label = "label-warning";
                                break;
                        }
                        container.append($("<li>")
                            .addClass("list-group-item")
                            .attr("route", route)
                            .attr("kind", type)
                            .append(
                                $("<span>").addClass("label" + " " + label).text(x)
                            )
                            .append(
                                getOptions(type)
                            )
                        );

                    }
                }
            }
            var $optionsJson;
            $("#btnStep1").click(function(event) {
                $optionsJson = JSON.parse($("#optionsJson").val());
                var $step2 = $(".step2");
                var $container = $step2.find('.container');
                $container.html('');
                buildTree($optionsJson, $container, "");
                $step2.show();
            });
            $("#btnStep2").click(function(event){
                var lines = ["return new JsonModel()"];
                var strRegister = "register";
                var strOptional = "Optional";
                var strMandatory = "Mandatory";
                var strNonEmpty = "NonEmpty";
                var strTypes = {"string": "String", "boolean": "Boolean", "object": "Object", "array": "Array", "number": "Number"};
                $(".step2 .container .list-group-item").each(function(){
                    var route = $(this).attr("route");
                    var kind = $(this).attr("kind");
                    var options = [];
                    $(this).children(".options").find("input:checked").each(function(){
                        if ($(this).hasClass("mandatory")) {
                            options.push("mandatory");
                        }
                        if ($(this).hasClass("nonEmpty")) {
                            options.push("nonEmpty");
                        }
                    });
                    var line = strRegister;
                    if (options.indexOf("mandatory") >= 0
                        && options.indexOf("nonEmpty") >= 0) {
                        line += strMandatory;
                        line += strNonEmpty;
                    } else if (options.indexOf("mandatory") >= 0) {
                            line += strMandatory;
                        } else if (options.indexOf("nonEmpty") >= 0) {
                            line += strNonEmpty;
                        } else {
                            line += strOptional;
                        }
                    line += strTypes[kind];
                    line += '("' + route + '")';
                    lines.push(line);
                });
                $("#result").text( lines.join("\n.") + ";" );
                $(".step3").show();
            });
        });
    </script>
  </body>
</html>
